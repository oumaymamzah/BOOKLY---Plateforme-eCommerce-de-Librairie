{% extends 'base.html.twig' %}

{% block title %}{{ livre.titre }} - Détails du Livre{% endblock %}

{% block body %}
<section id="page-header" class="padding-large" style="background-image: url('{{ asset('images/banner-image-bg.jpg') }}'); background-size: cover; background-repeat: no-repeat; background-position: center; height: 300px; display: flex; align-items: center;">
  <div class="container">
    <div class="row">
      <div class="col-md-12 text-center">
        <h1 class="display-4 text-white">{{ livre.titre }}</h1>
        <p class="lead text-white">Par {{ livre.auteurs ? livre.auteurs|join(', ') : 'Auteur Inconnu' }}</p>
      </div>
    </div>
  </div>
</section>

<section class="padding-large">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <div class="image-holder">
          <img src="{% if livre.pdfFilename %}{{ asset('uploads/images/' ~ livre.pdfFilename) }}{% else %}{{ asset('images/product-item' ~ (livre.id % 12 + 1) ~ '.png') }}{% endif %}" class="img-fluid" alt="{{ livre.titre }}">
        </div>
      </div>
      <div class="col-md-6">
        <div class="product-details">
          <h2>{{ livre.titre }}</h2>
          <div class="rating text-warning d-flex align-items-center mb-3">
            <svg class="star star-fill">
              <use xlink:href="#star-fill"></use>
            </svg>
            <svg class="star star-fill">
              <use xlink:href="#star-fill"></use>
            </svg>
            <svg class="star star-fill">
              <use xlink:href="#star-fill"></use>
            </svg>
            <svg class="star star-fill">
              <use xlink:href="#star-fill"></use>
            </svg>
            <svg class="star star-fill">
              <use xlink:href="#star-fill"></use>
            </svg>
            <span class="ms-2 text-black-50">(4.5)</span>
          </div>

          <div class="price mb-4">
            {% if livre.prixUnitaire > 100 %}
            <span class="text-primary fw-bold fs-3">{{ livre.prixUnitaire }} DT</span>
            <span class="text-muted ms-2"><s>{{ (livre.prixUnitaire * 1.2)|round(2) }} DT</s></span>
            <span class="badge bg-success ms-2">Save {{ (livre.prixUnitaire * 0.2)|round(2) }} DT</span>
            {% else %}
            <span class="text-primary fw-bold fs-3">{{ livre.prixUnitaire }} DT</span>
            {% endif %}
          </div>

          <div class="product-info mb-4">
            <p><strong>Auteur :</strong> {{ livre.auteurs ? livre.auteurs|join(', ') : 'Auteur Inconnu' }}</p>
            <p><strong>Éditeur :</strong> {{ livre.editeurs ? livre.editeurs.nom : 'Inconnu' }}</p>
            <p><strong>Catégorie :</strong> {{ livre.categorie ? livre.categorie.nom : 'Non catégorisé' }}</p>
            <p><strong>ISBN :</strong> {{ livre.isbn ?: 'Non disponible' }}</p>
          </div>

          <div class="quantity mb-4 d-flex flex-column align-items-center">
            <label class="form-label">Quantité :</label>
            <div class="d-flex align-items-center gap-2">
              <button class="btn btn-outline-secondary btn-lg px-3" type="button" id="decreaseQty" style="width: 50px; height: 50px; font-size: 1.2rem;">-</button>
              <input type="number" class="form-control text-center fw-bold" id="quantityInput" value="1" min="1" readonly style="width: 80px; height: 50px; font-size: 1.2rem;">
              <button class="btn btn-outline-secondary btn-lg px-3" type="button" id="increaseQty" style="width: 50px; height: 50px; font-size: 1.2rem;">+</button>
            </div>
          </div>

          <div class="action-buttons d-flex justify-content-center gap-3">
            <form action="{{ path('app_cart_add', {'id': livre.id}) }}" method="post">
              <input type="hidden" name="quantity" id="cartQuantity" value="1">
              <button type="submit" class="btn btn-primary btn-lg">
                <svg class="me-2" width="20" height="20">
                  <use xlink:href="#cart"></use>
                </svg>
                Ajouter au Panier
              </button>
            </form>
            {% if app.session.get('wishlist') is defined and livre.id in app.session.get('wishlist') %}
              <a href="{{ path('app_wishlist_remove', {'id': livre.id}) }}" class="btn btn-danger btn-lg">
                <svg class="me-2" width="20" height="20">
                  <use xlink:href="#heart"></use>
                </svg>
                Retirer de la Liste d'Envies
              </a>
            {% else %}
              <a href="{{ path('app_wishlist_add', {'id': livre.id}) }}" class="btn btn-outline-primary btn-lg">
                <svg class="me-2" width="20" height="20">
                  <use xlink:href="#heart"></use>
                </svg>
                Ajouter à la Liste d'Envies
              </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-5">
      <div class="col-12">
        <div class="product-description">
          <h3>Description</h3>
          <p>{{ livre.description ?: 'Aucune description disponible pour ce livre.' }}</p>
        </div>
      </div>
    </div>

    <!-- PDF Preview Section -->
    {% if livre.pdfFilename %}
    <div class="row mt-5">
      <div class="col-12">
        <div class="pdf-preview">
          <h3><i class="fas fa-image text-primary me-2"></i>Image du Livre</h3>
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <div>
                  <h6 class="mb-1">{{ livre.titre }} - Image</h6>
                  <small class="text-muted">Cliquez pour voir ou télécharger l'image</small>
                </div>
                <div>
                  <a href="{{ asset('uploads/images/' ~ livre.pdfFilename) }}" target="_blank" class="btn btn-primary me-2">
                    <i class="fas fa-eye me-1"></i>Voir l'Image
                  </a>
                  <a href="{{ asset('uploads/images/' ~ livre.pdfFilename) }}" download class="btn btn-success">
                    <i class="fas fa-download me-1"></i>Télécharger
                  </a>
                </div>
              </div>
              <div class="pdf-embed-container" style="height: 600px; border: 1px solid #dee2e6; border-radius: 0.375rem;">
                <img src="{{ asset('uploads/images/' ~ livre.pdfFilename) }}" class="img-fluid" alt="Book Image" style="max-height: 100%; object-fit: contain;">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}

  </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const decreaseBtn = document.getElementById('decreaseQty');
  const increaseBtn = document.getElementById('increaseQty');
  const quantityInput = document.getElementById('quantityInput');
  const cartQuantity = document.getElementById('cartQuantity');

  decreaseBtn.addEventListener('click', function() {
    let currentValue = parseInt(quantityInput.value);
    if (currentValue > 1) {
      quantityInput.value = currentValue - 1;
      cartQuantity.value = quantityInput.value;
    }
  });

  increaseBtn.addEventListener('click', function() {
    let currentValue = parseInt(quantityInput.value);
    quantityInput.value = currentValue + 1;
    cartQuantity.value = quantityInput.value;
  });
});
</script>

{% endblock %}
